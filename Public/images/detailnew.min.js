$(function() {
    function q(a) {
        if ("off" == h) return h = "on",
        "off";
        $.ajax({
            url: GUANGER.path + "/baobei/listComment/" + goods.id,
            type: "post",
            dataType: "html",
            data: {
                p: a + 1
            },
            success: function(a) {
                $("#J_ShowResult").html(a);
                $(window).scrollTop(r);
                l()
            }
        })
    }
    function s(a, b) {
        if ("" != b && 2 <= $.guang.util.getStrLength(b)) {
            if (1E3 < $.guang.util.getStrLength(b)) return $.guang.tip.conf.tipClass = "tipmodal tipmodal-general",
            $.guang.tip.show(a, ">_< \u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u8d85\u8fc71000\u4e2a\u6c49\u5b57\uff01"),
            !1
        } else return $.guang.tip.conf.tipClass = "tipmodal tipmodal-general",
        $.guang.tip.show(a, ">_< \u4f60\u7684\u8bc4\u8bba\u592a\u77ed\u5566\uff0c\u518d\u591a\u8bf4\u51e0\u53e5\u5427\uff01"),
        !1;
        return ! 0
    }
    function l() {
        var a = $("#J_rightheight").height();
        "564" >= a ? $("#J_leftheight").animate({
            height: 564
        }) : $("#J_leftheight").animate({
            height: a
        })
    }
    Do("plugin/lazyload",
    function() {
        $(".goods-pic img,.goods-huabao img,.goods-zhuti img").lazyload({
            effect: "fadeIn",
            threshold: 600
        })
    });
    $("#scrollable").scrollable();
    $("#baobeiscrollable").scrollable();
    $(".pic-box, .mouse-replace").hover(function() {
        $(".btn-like").show()
    },
    function() {
        $(".btn-like").hide()
    });
    $(".btn-like").bind("mouseover",
    function() {
        $(".btn-like").show()
    });
    $(".btn-like").click(function() {
        $.guang.dialog.like_say(this,
        function() {})
    });
    $.ajax({
        url: GUANGER.path + "/cpc/incrementPV",
        type: "post",
        dataType: "json",
        data: {
            productIds: goods.cpc_productIds,
            key: goods.cpc_key
        }
    });
    $.ajax({
        url: GUANGER.path + "/baobei/json/high_light_tag/" + goods.id,
        type: "post",
        dataType: "json",
        data: {
            galleryId: goods.galleryId,
            count: 15
        },
        success: function(a) {
            var b = "",
            j = a.recommendProductList,
            e = j.length;
            5 > e && $("#J_Tag").find(".action").eq(0).remove();
            if (0 < e) {
                $.each(j,
                function(a, c) {
                    0 == a % 5 && (b += '<div class="item"><ul class="clearfix">');
                    b += "<li " + (4 == a % 5 ? 'class="last"': "") + ">";
                    b += '<div class="pic">';
                    b += '<a href="' + GUANGER.path + "/faxian/" + goods.galleryName + "/" + c.tagName + '"class="clearfix"  target="_blank" title="' + c.tagName + '">';
                    b += '<img src="' + c.photo + '" alt="' + c.tagName + '">';
                    b += "</a>";
                    b += "</div>";
                    b += '<div class="pic-text">' + c.tagName + "<br>";
                    b += "<span>" + c.productCount + "\u4ef6\u5b9d\u8d1d</span></div>";
                    b += "</li>";
                    if (4 == a % 5 || a == e - 1) b += "</ul></div>"
                });
                $("#baobeiscrollable .items").append(b);
                var c = "";
                $.each(a.highLighTagProductsList,
                function(b, f) {
                    0 == b % 5 && (c += '<div class="item"><ul class="clearfix">');
                    c += "<li " + (4 == b % 5 ? 'class="last"': "") + ">";
                    c += '<div class="pic">';
                    c += '<a href="' + GUANGER.path + "/faxian/" + goods.galleryName + "/" + f.tagName + '"class="clearfix"  target="_blank" title="' + f.tagName + '">';
                    c += '<img src="' + f.photo + '" alt="' + f.tagName + '">';
                    c += "</a>";
                    c += "</div>";
                    c += '<div class="pic-text">' + f.tagName + "<br>";
                    c += "<span>" + f.productCount + "\u4ef6\u5b9d\u8d1d</span></div>";
                    c += "</li>";
                    if (4 == b % 5 || b == a.highLighTagProductsList.length - 1) c += "</ul></div>"
                });
                $("#scrollable .items").append(c)
            } else 0 == e && ($("#J_Tag .tag").eq(0).remove(), $("#J_Tag .action,#scrollable").remove(), c = "", c += '<ul class="clearfix">', $.each(a.highLighTagProductsList,
            function(a, b) {
                10 > a && (c += "<li " + (4 == a % 5 ? 'class="last"': "") + ">", c += '<div class="pic">', c += '<a href="' + GUANGER.path + "/faxian/" + goods.galleryName + "/" + b.tagName + '"class="clearfix"  target="_blank" title="' + b.tagName + '">', c += '<img src="' + b.photo + '" alt="' + b.tagName + '">', c += "</a>", c += "</div>", c += '<div class="pic-text">' + b.tagName + "<br>", c += "<span>" + b.productCount + "\u4ef6\u5b9d\u8d1d</span></div>", c += "</li>")
            }), c += "</ul>", $("#J_Tag .tag").eq(0).append(c))
        }
    });
    $(".J_JiuCuo").click(function() {
        $(this).parent().html("<span>\u5df2\u53cd\u9988</span>");
        $.get(GUANGER.path + "/ugc/delist?productId=" + goods.id,
        function() {}).success(function() {})
    });
    $(".J_Abandon").click(function() {
        $(this);
        $.ajax({
            url: GUANGER.path + "/ugc/putOffProduct?productId=" + goods.id,
            type: "get",
            dataType: "json",
            success: function() {
                alert("\u5df2\u7ecf\u4e0b\u67b6~\u7a0d\u540e\u66f4\u65b0\u7d22\u5f15!")
            }
        })
    });
    $(".thumb-list li").mouseover(function() {
        if (!$(this).hasClass("cur")) {
            var a = $(this).find("img").attr("data-src");
            $(".pic-box img").attr("src", a);
            $(".thumb-list li.cur").removeClass("cur");
            $(this).addClass("cur")
        }
    });
    $(".thumb-list").scrollable({
        circular: !1,
        prev: ".thumb-nav-prev",
        next: ".thumb-nav-next",
        disabledClass: "disable"
    });
    var t = $("#J_Pagination1"),
    r = $("#J_ShowResult").offset().top - 40,
    h = "off";
    $("#J_Pagination").toggle(function() {
        $(this).addClass("on").html("\u6536\u8d77\u8bc4\u8bba(" + goods.current_pageName + ")");
        $("#J_ShowResult .cmt-noworth").show();
        l()
    },
    function() {
        $(this).removeClass("on").html("\u5c55\u5f00\u8bc4\u8bba(" + goods.current_pageName + ")");
        for (var a = 0; 10 > a; a++) 2 < a && $("#J_ShowResult .cmt-noworth").eq(a).hide();
        l()
    }); (function() {
        h = "off";
        var a = parseInt(goods.commentSum);
        t.pagination(a, {
            num_edge_entries: 1,
            num_display_entries: 4,
            callback: q,
            items_per_page: 10,
            current_page: 0
        })
    })();
    $("#J_PublishBtn").click(function() {
        if ($.guang.dialog.isLogin()) {
            var a = $(this),
            b = $.trim($("#J_CommentTxa").val()),
            j = !1;
            s(a, b) && !j && $.ajax({
                url: GUANGER.path + "/baobei/commentMore",
                type: "post",
                dataType: "json",
                data: {
                    productId: goods.id,
                    commentContent: b
                },
                beforeSend: function() {
                    j = !0
                },
                success: function(e) {
                    j = !1;
                    if (100 == e.code) {
                        $("#J_CommentTxa").val("");
                        var c;
                        c = e.commentContent;
                        var e = e.commentId,
                        g = GUANGER.nick,
                        f = GUANGER.level,
                        d = GUANGER.userId,
                        h = d ? d: "",
                        g = g ? g: "",
                        k = GUANGER.userPhoto,
                        m = "",
                        i = "";
                        d ? (m = '<a class="fl" href="http://guang.com/u/' + h + '" target="_blank">' + g + "</a>", i = '<a href="http://guang.com/u/' + h + '"><img src="' + k + '" alt="' + g + '" /></a>', f && "daren" == f && (m = '<a class="fl g-daren" href="http://guang.com/u/' + h + '" target="_blank"><em>' + g + '</em><i class="i-daren">\u8fbe\u4eba</i></a>')) : (m = '<span class="fl">' + g + "</span>", i = '<img src="' + k + '" alt="' + g + '" />');
                        $("#J_ShowResult").prepend('<div class="cmt clearfix cmt-noworth"  data-cmtid="' + e + '"><div class="user-pic">' + i + '</div><div class="cmt-doc bg-gray"><div class="cmt-info clearfix">' + m + '<span class="fl gc"></span><span class="fr gc">\u6765\u81ea Guang.com</span><span class="fr gc mr10">\u521a\u521a</span></div><p class="cmt-content clearfix"><span>' + c + '</span><a class="J_CmtReplyBtn btn">\u56de\u590d<em class="J_ReplyCount" data-count="0"></em></a></p></div></div>');
                        feedsRecommend(goods.id, b);
                        l()
                    } else $.guang.tip.conf.tipClass = "tipmodal tipmodal-error",
                    $.guang.tip.show(a, e.msg)
                }
            })
        }
    });
    l();
    $(".topic-recommend").hover(function() {
        var a = $(this);
        delay = setTimeout(function() {
            a.find(".J_picGrid").animate({
                top: "148px"
            },
            150)
        },
        200)
    },
    function() {
        clearTimeout(delay);
        $(this).find(".J_picGrid").animate({
            top: "232px"
        },
        150)
    });
    $("#J_CommentTxa").focus(function() {
        $("#J_CommentsShare").show()
    });
    var k = $("#J_CpcBox").offset().top,
    i = $("#J_TagsBox").offset().top,
    n = $("#J_ZhutiBox").offset().top,
    d = $("#J_goodsnav"),
    u = $("#J_goodsnav li");
    $(window).resize(function() {
        0 > ($(window).width() - 980) / 2 - d.width() - 30 && d.hide()
    });
    $(window).scroll(function() {
        var a = ($(window).width() - 980) / 2 - d.width() - 30;
        if (0 < a) {
            var b = $(window).scrollTop() + 90;
            b > k ? ($.guang.util.isIE6() ? setTimeout(function() {
                $("#J_goodsnav").css("top", b - k + 40 + "px")
            },
            200) : (d.show().css("top", "40px"), d.show().css("left", a + "px")), b < i && $("#J_BaobeiNav").addClass("on").siblings().removeClass("on"), b > i && b < n && $("#J_FaxianNav").addClass("on").siblings().removeClass("on"), b > n && $("#J_ZhutiNav").addClass("on").siblings().removeClass("on")) : d.hide()
        }
    });
    u.click(function() {
        var a = $(this),
        b = a.attr("id");
        a.addClass("on").siblings().removeClass("on");
        a = 0;
        "J_BaobeiNav" == b ? a = k - 20 : "J_FaxianNav" == b ? a = i - 30 : "J_ZhutiNav" == b && (a = n - 70);
        $("html,body").scrollTop(a)
    });
    $(".goods").hover(function() {
        var a = $(this);
        a.closest(".section").css("zIndex", "50");
        a.css("zIndex", "50");
        a.data("pid");
        a.addClass("cur-goods");
        var b = a.find(".goods-clone");
        if (1 > b.length) {
            b = a.html();
            a.append('<div class="goods-clone">' + b + "</div>");
            var b = a.find(".goods-clone"),
            a = b.find(".goods-pic img"),
            d = a.data("original");
            a.css("opacity", 1);
            a.attr("src", d)
        } + "\u000b1" || b.css({
            border: "1px #dedede solid"
        });
        b.fadeIn("fast");
        b.slideDown("slow")
    },
    function() {
        var a = $(this);
        a.closest(".section").css("zIndex", "0");
        a.css("zIndex", "0");
        a.removeClass("cur-goods");
        a = a.find(".goods-clone");
        1 == a.length && (a.fadeOut("fast"), a.slideUp("slow"))
    });
    $(".small-like-icon").live("click",
    function() {
        $.guang.dialog.like_say(this,
        function() {})
    });
    if ($("#J_TopicsetTitle")[0]) {
        $("#J_TopicsetTitle").tabs("#J_topicsetTab ul li", {
            event: "mouseover",
            tabs: "li",
            rotate: !0
        });
        var v = $("#J_TopicsetTitle").data("tabs"),
        o = null,
        p = function() {
            o = setInterval(function() {
                v.next()
            },
            5E3)
        };
        p();
        $("#J_TopicsetTitle").find("li").hover(function() {
            clearInterval(o)
        },
        function() {
            p()
        });
        $("#J_topicsetTab ul").find("li").hover(function() {
            clearInterval(o)
        },
        function() {
            p()
        })
    }
    $(".later-show")[0] && setTimeout(function() {
        $(".later-show").removeClass("later-show")
    },
    1500)
});