!function(a){a.feedsRecommend=function(b,c){var d=JSON.stringify({content:c}),e=[];a("#J_LikeDialog #s_guang_ilike")[0].checked&&e.push("guang"),a("#J_UserSns li").each(function(){var b=a(this),c=b.data("status"),d=b.data("snsid");"on"==c&&e.push(d)}),a.ajax({url:GUANGER.path+"/snsShare",type:"post",dataType:"json",data:{type:"baobei",id:b,comment:d,snsSiteIds:e.join(",")},success:function(){}})},a.guang.ilike={likeOper:function(b,c,d,e){var f="0"==d?"/baobei/favor":"/baobei/identity",g="";b.data("sid")&&(g=b.data("sid")),a.ajax({url:GUANGER.path+f,type:"post",dataType:"json",data:{productId:c,identify:"1"==d?"1":"0",sid:g},success:function(c){if(c){var f=c;switch(f.code){case 100:a.guang.ilike.likeCallback(b,d,e);break;case 101:a.guang.ilike.likeCallback(b,0,e);break;case 103:a.guang.ilike.likeCallback(b,1);break;case 666:a.guang.ilike.awardClk(b)}}else a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show(b,"\u8bf7\u6362\u4e00\u4e2a\u975e\u5546\u5bb6\u5e10\u53f7\u559c\u6b22\u5546\u54c1~")},error:function(c){if(405==c.status){var d=c.getResponseHeader("RSTYPE");a.guang.antiSpam.verification(d,function(){b.trigger("click")})}}})},createTopicJson:{},likeCallback:function(b,c,d){if(0==c){d&&d();var e=b.find(".ilikeCount"),f=e.data("val")+1;if(e.data("val",f),""==GUANGER.userId){var g=a.cookie("productFavor");if(null!=g&&""!=g){var h=g.split(",").length;a(".unlogin-like-text .count").text(h),a(".unlogin-like").show()}}}b.data("enable","enable");var i=0==c?"\u559c\u6b22\u4e86~":"\u559c\u6b22\u8fc7\u4e86~";if(""==GUANGER.userId)return a.guang.tip.conf.tipClass="tipmodal tipmodal-ok",a.guang.tip.show(b,i),!1;if(a("#J_LikeDialog")[0])a("#J_LikeDialog .title").html(i),a("#J_NewTopic, #J_SaySth").val(""),a("#J_LikeDialog .topic-list input:checked").each(function(){var b=a(this);b[0].checked=!1}),a("#J_LikeDialog").data("overlay").load();else{var j="";j+='<div id="J_LikeDialog" class="like-dialog"><div class="content"><div class="title">'+i+"</div>"+"<p>\u628a\u5b83\u52a0\u5165\u4e3b\u9898\uff0c\u65b9\u4fbf\u4e4b\u540e\u518d\u627e\u7740\u5b83~</p>"+'<div class="topic-box">'+'<ul class="topic-list">'+"</ul>"+"</div>"+'<div class="create-box">'+'<a class="btn-plus" href="javascript:;"></a>'+'<input type="text" name="new-topic" id="J_NewTopic" placeholder="\u521b\u5efa\u65b0\u4e3b\u9898\uff08\u56de\u8f66\u76f4\u63a5\u521b\u5efa\uff09" />'+'<a class="btn-enter" href="javascript:;"></a>'+"</div>"+'<div class="say-box">'+'<input type="text" name="say-text" id="J_SaySth" placeholder="\u8bf4\u4e24\u53e5" />'+"</div>"+'<div class="clearfix" id="comment-form">'+'<label class="fl pt10" for="s_guang_ilike"><input id="s_guang_ilike" type="checkbox" value="guang" /> \u63a8\u8350\u7ed9\u901b\u7c89</label>'+'<div class="share-comment">'+'<span class="gc">\u540c\u6b65\u5206\u4eab\uff1a</span>'+'<ul id="J_UserSns">'+"</ul>"+'<span><a href="'+GUANGER.path+'/account/sns" target="_blank">\u8bbe\u7f6e</a></span>'+"</div>"+"</div>"+'<div class="clearfix pt10">'+'<input type="button" class="bbl-btn done" value="\u5b8c\u6210" />'+'<input type="button" class="bgr-btn cancel ml10" value="\u53d6\u6d88" />'+"</div>"+'<a class="close" href="javascript:;"></a>'+"</div>"+"</div>",a("body").append(j),a("#J_LikeDialog").overlay({top:"center",mask:{color:"#000",loadSpeed:200,opacity:.3},closeOnClick:!1,load:!0}),a.getJSON(GUANGER.path+"/u/topic/toAddProduct?"+Math.floor(new Date/10),function(b){if(100==b.code){var c=[];a.map(b.userTopics,function(a){c.push('<li class="ofh"><label for="'+a.id+'"><input type="checkbox" id="'+a.id+'" /> '+a.title+"</label></li>")}),a("#J_LikeDialog .topic-list").html(c.join(""))}else 110==b.code?a("#J_LikeDialog .topic-list").html('<li class="no-topic">\u4f60\u8fd8\u6ca1\u521b\u5efa\u8fc7\u4e3b\u9898</li>'):a("#J_LikeDialog .topic-list").html("<li>\u83b7\u53d6\u4e3b\u9898\u5217\u8868\u5931\u8d25</li>")});var k={sina:"ss-sina",tec_weibo:"ss-tencent",qzone:"ss-qzone"},l=a("#J_LikeDialog #J_UserSns");a.ajax({url:GUANGER.path+"/account/getUserSns.html",type:"post",dataType:"json",success:function(b){if(100==b.code){var c="",d=b.userSns;for(var e in d)k[e]&&(c+='<li class="share-switch '+k[e]+"-btnclick-"+d[e]+' btnclick" data-status="'+d[e]+'" data-snsid="'+e+'" data-webname="'+k[e]+'"></li>');l.append(c),a("#J_LikeDialog .btnclick").unbind().bind("click",function(){var b=a(this),c=b.attr("data-webname")+"-btnclick-on",d=b.attr("data-webname")+"-btnclick-off";"on"==b.data("status")?b.removeClass(c).addClass(d).data("status","off"):b.removeClass(d).addClass(c).data("status","on")})}}}),a("#J_LikeDialog .btn-plus").click(function(b){b.preventDefault(),a("#J_NewTopic").focus()}),a("#J_NewTopic").keyup(function(b){var c=a(this);"13"==b.keyCode&&a("#J_LikeDialog .btn-enter").trigger("click"),""!=a.trim(c.val())?a("#J_LikeDialog .btn-enter").show():a("#J_LikeDialog .btn-enter").hide()}),a("#J_LikeDialog .btn-enter").click(function(b){b.preventDefault();var c=a("#J_NewTopic"),d=a.trim(c.val());""==d?(a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show(c,"\u4e3b\u9898\u540d\u5b57\u4e0d\u80fd\u4e3a\u7a7a"),a("#J_NewTopic").focus()):(a.guang.ilike.createTopicJson.topicName=d,a.guang.ilike.createTopicJson.gallerys="",a.ajax({url:GUANGER.path+"/u/topic/create_topic",type:"post",dataType:"json",data:a.guang.ilike.createTopicJson,success:function(b){if(100==b.code)c.val(""),a("#J_LikeDialog .topic-list .no-topic")[0]&&a("#J_LikeDialog .topic-list .no-topic").remove(),a("#J_LikeDialog .topic-list").prepend('<li class="ofh"><label for="'+b.topicId+'"><input type="checkbox" id="'+b.topicId+'" checked /> '+d+"</label></li>");else if(111==b.code){if(!a("#J_VcodeBox")[0]){var e='<div id="J_VcodeBox"><div class="vCode"><img src="http://guang.com/captcha" alt="\u9a8c\u8bc1\u7801" /><a class="another inlineblock" href="javascript:;">\u770b\u4e0d\u6e05\uff0c\u6362\u4e00\u4e2a</a></div><div class="captcha-row clearfix"><input type="text" name="captcha" class="base-input code-input" value="" /><a href="javascript:;" id="J_VcodeBtn" class="bbl-btn">\u63d0\u4ea4</a></div></div>';a("#J_LikeDialog .content").append(e),a("#J_VcodeBox .another").unbind("click").bind("click",function(){a("#J_VcodeBox .vCode img").attr("src","http://guang.com/captcha?"+parseInt(1e6*Math.random()))})}}else 130==b.code?(a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show(c,"\u9a8c\u8bc1\u7801\u8f93\u5165\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5~")):(a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show(c,"\u521b\u5efa\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5~"));a.guang.ilike.createTopicJson.captcha&&(a.guang.ilike.createTopicJson={})}}))}),a("#J_VcodeBtn").live("click",function(){a.guang.ilike.createTopicJson.captcha=a("#J_VcodeBox .code-input").val(),a("#J_VcodeBox").empty().remove(),a("#J_LikeDialog .btn-enter").trigger("click")}),a("#J_LikeDialog .cancel").click(function(){a("#J_LikeDialog").data("overlay").close()})}a("#J_LikeDialog .done").unbind("click").bind("click",function(){var c=a(this),d={};if(!c.data("clicked")){var e=[];a("#J_LikeDialog .topic-list input:checked").each(function(){var b=a(this);e.push(b.attr("id"))}),d.topicIds=e.join(","),d.productId=b.data("proid"),d.userComment=a.trim(a("#J_LikeDialog #J_SaySth").val());var f=a("#J_LikeDialog #J_UserSns li").length;if(f>0)for(var g=0;f>g;g++)if("on"==a("#J_LikeDialog #J_UserSns li").eq(g).data("status")){var h=a("#J_LikeDialog #J_UserSns li").eq(g).data("snsid");d.snsSiteIds?d.snsSiteIds+=","+h:d.snsSiteIds=h}var i="\u559c\u6b22\u4e86\u300a$\u300b",j=135,k=b.data("proname"),l=b.data("prourl"),m=d.userComment,n=j-a.guang.util.getStrLength(i+k+l);d.commentContent4Sns=a.guang.util.getStrLength(m)>n?i.replace("$",k)+a.guang.util.substring4ChAndEn(m,n)+"..."+l:0==a.guang.util.getStrLength(m)?i.replace("$",k)+l:i.replace("$",k)+":"+m+"\u3002"+l,0==e.length&&""==m?(a("#J_LikeDialog").data("overlay").close(),a.feedsRecommend(d.productId,d.userComment)):a.ajax({url:GUANGER.path+"/u/topic/addProductFromDetail",type:"post",dataType:"json",data:d,beforeSend:function(){c.data("clicked",!0)},success:function(b){c.data("clicked",!1),100==b.code?(a.guang.tip.conf.tipClass="tipmodal tipmodal-ok",a.guang.tip.show(c,"\u63d0\u4ea4\u6210\u529f~"),a("#J_LikeDialog").data("overlay").close(),a.feedsRecommend(d.productId,d.userComment)):(a.guang.tip.conf.tipClass="tipmodal tipmodal-error",a.guang.tip.show(c,b.msg))}})}})}},a.guang.dialog.like_say=function(b,c){if("guang.b5m.com"==window.location.host&&""==GUANGER.userId)return window.location.href="http://ucenter.b5m.com",!1;var d=a(b);if("disable"==d.data("enable"))return!1;d.data("enable","disable");var e=d.attr("data-type"),f=d.attr("data-proid");a.guang.ilike.likeOper(d,f,e,c)}}(jQuery);